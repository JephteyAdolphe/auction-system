package com.cs336.pkg;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.*;
import java.io.*;

public class ApplicationDB {
	
	public ApplicationDB(){
		
	}

	public Connection getConnection(){
		
		//Create a connection string
		String connectionUrl = "jdbc:mysql://localhost:3306/project";	// project is the databse created in mysql
		Connection connection = null;
		
		try {
			//Load JDBC driver - the interface standardizing the connection procedure. Look at WEB-INF\lib for a mysql connector jar file, otherwise it fails.
			Class.forName("com.mysql.jdbc.Driver").newInstance();
		} catch (InstantiationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IllegalAccessException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			//Create a connection to your DB
			connection = DriverManager.getConnection(connectionUrl,"root", "password");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return connection;
		
	}
	
	public void closeConnection(Connection connection){
		try {
			connection.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	
	
	
	
	public static void main(String[] args) {
		ApplicationDB dao = new ApplicationDB();
		Connection connection = dao.getConnection();
		
		System.out.println(connection);		
		dao.closeConnection(connection);
	}
	
	public boolean accountExists(String accountID, String password){
		try {
			// LOG IN

			//Get the database connection
			Connection con = this.getConnection();

			//Create a SQL statement
			Statement stmt = con.createStatement();

			//Check if account exists:
			String sql = String.format("select account_id, password from account where account_id = '%s' and password = '%s'", accountID, password);
			
			//Run the query against the DB
			ResultSet rs = stmt.executeQuery(sql);
			
			while (rs.next()) {
				if (rs.getString("account_id").equals(accountID) && rs.getString("password").equals(password)) {
					System.out.println("ACCOUNT EXISTS - Logged In");
					con.close();
					return true;
				} else {
					break;
				}
			}

			//Close the connection with no account match
			con.close();
			return false;
								
		} catch (Exception ex) {
			//System.out.println(ex);
			System.out.println("Account Does Not Exist");
			return false;
		}
	}
	
	public void createAccount(String accountID, String password){
		try {
			// Sign Up

			//Get the database connection
			Connection con = this.getConnection();

			//Create a SQL statement
			Statement stmt = con.createStatement();

			//Check if account exists:
			String sql = String.format("insert account_id, password from account where account_id = '%s' and password = '%s'", accountID, password);
			
			//Run the query against the DB
			ResultSet rs = stmt.executeQuery(sql);
			
			while (rs.next()) {
				if (rs.getString("account_id").equals(accountID) && rs.getString("password").equals(password)) {
					System.out.println("ACCOUNT EXISTS - Logged In");
					con.close();
					return true;
				} else {
					break;
				}
			}

			//Close the connection with no account match
			con.close();
			return false;
								
		} catch (Exception ex) {
			//System.out.println(ex);
			System.out.println("Account Does Not Exist");
			return false;
		}
	}

}
